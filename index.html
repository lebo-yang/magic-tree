<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”æ³•åœ£è¯æ ‘ - äº¤äº’å¢å¼ºç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background: #001529; overflow: hidden; font-family: sans-serif; }
        #canvas-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { position: absolute; }
        
        /* éŸ³ä¹æ’­æ”¾æŒ‰é’® */
        #music-btn {
            position: fixed; bottom: 30px; z-index: 100;
            padding: 12px 24px; background: #c41e3a; color: white;
            border: none; border-radius: 25px; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
        }

        /* çŠ¶æ€æç¤º */
        #status {
            position: fixed; top: 10px; color: #ffd700; font-size: 14px;
            background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px;
        }

        .tree-container { font-size: 40px; text-align: center; line-height: 1.2; user-select: none; }
        .star { color: #2e7d32; font-size: 60px; text-shadow: 0 0 20px #4caf50; }
        .sparkle { color: #ffd700; position: absolute; animation: rotate 5s linear infinite; }
        
        @keyframes rotate {
            from { transform: rotate(0deg) translateX(80px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(80px) rotate(-360deg); }
        }
    </style>
</head>
<body>

    <div id="status">ç³»ç»ŸçŠ¶æ€: æ­£åœ¨åˆå§‹åŒ–æ‘„åƒå¤´...</div>
    <button id="music-btn" onclick="toggleMusic()">ğŸµ ç‚¹å‡»å¼€å¯åœ£è¯éŸ³ä¹ & é­”æ³•</button>

    <div id="canvas-container">
        <div class="tree-container" id="tree">
            <div class="star">â˜…</div>
            <div>âœ¨ğŸ„âœ¨</div>
            <div>ğŸğŸ„ğŸğŸ„ğŸ””</div>
            <div>âœ¨ğŸ„ğŸğŸ„âœ¨ğŸ„ğŸ</div>
            <div>ğŸğŸ„ğŸ””ğŸ„ğŸğŸ„ğŸ””ğŸ„</div>
            <div style="color: #5d4037;">ğŸ¤</div>
        </div>
        <canvas id="output_canvas"></canvas>
    </div>

    <iframe id="music-player" frameborder="no" border="0" marginwidth="0" marginheight="0" width=1 height=1 
        src="//music.163.com/outchain/player?type=2&id=2657777735&auto=0&height=32">
    </iframe>

    <script>
        const tree = document.getElementById('tree');
        const status = document.getElementById('status');
        const musicBtn = document.getElementById('music-btn');
        let isPlaying = false;

        function toggleMusic() {
            const player = document.getElementById('music-player');
            if(!isPlaying) {
                player.src += "&auto=1"; // æ¿€æ´»æ’­æ”¾
                musicBtn.innerText = "âœ¨ é­”æ³•å·²å¼€å¯ (è¯·æŒ¥åŠ¨åŒæŒ)";
                musicBtn.style.background = "#2e7d32";
                isPlaying = true;
            }
        }

        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 2,
            modelComplexity: 1,
            minDetectionConfidence: 0.5, // é™ä½é—¨æ§›ï¼Œæ›´å®¹æ˜“è¯†åˆ«
            minTrackingConfidence: 0.5
        });

        hands.onResults((results) => {
            status.innerText = results.multiHandLandmarks.length > 0 ? "âœ… è¯†åˆ«åˆ°æ‰‹æŒï¼" : "â“ è¯·å°†æ‰‹æŒå±•ç¤ºåœ¨æ‘„åƒå¤´å‰";
            
            if (results.multiHandLandmarks.length > 0) {
                // æ‰‹æŒæ§åˆ¶æ ‘çš„ç¼©æ”¾
                const scale = 1 + results.multiHandLandmarks.length * 0.2;
                tree.style.transform = `scale(${scale})`;
                tree.style.filter = `drop-shadow(0 0 20px gold)`;
            } else {
                tree.style.transform = `scale(1)`;
                tree.style.filter = `none`;
            }
        });

        const videoElement = document.createElement('video');
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 1280,
            height: 720
        });
        camera.start();
    </script>
</body>
</html>
